---
title: 内存管理
date: 2018-09-14 19:21:28
comments: true
categories: Python
tags: 内存管理
---
#### 一、python中变量的赋值
掌握：
（1）、数字、字符串、布尔值的缓存
（2）、垃圾回收机制中的引用计数机制


python中所有的数据都是对象，所有的变量都是对象的引用。

python对数字、字符串和布尔对象进行缓存，让不同的变量赋同样值的这些对象，给得地址是同样的地址。

总结：
1、给一个变量赋值的时候，赋的是数字、字符串、布尔的时候，会先在缓存中看是否存在这个值，若有直接将值对应的地址赋给变量。没有就在缓存中开辟空间存储数据，然后返回地址。
2、给一个变量赋值的时候，赋的是除了数字、字符串、布尔以外的值，就直接在内存中开辟空间存储值，返回地址。

一个变量存了一个对象的地址，那么这个变量就是这个对象的引用。

#### 二、python中的内存管理
C的内存管理机制：手动
java/oc/python等：拥有一套属于自己的自动内存管理机制。

1、python通过垃圾回收机制来对内存进行管理的：不定时对程序中的对象进行检测，看是否需要回收（将对象的内存释放）。看是否需要回收旧看对象的引用计数是否为0，为0就回收。

2、引用计数
python中的每个对象在创建的时候就会有一个属性叫引用计数，对应的值是 0 。当对象被引用一次，其引用计数就会加 1 。 当对象的引用减少一个，其引用计数就会减 1 。
```
from sys import getrefcount

object1 = [1, 2]
object2 = object1
a = [object1, 2]
print(getrefcount(object1))  #查看引用计数
# getrefcount函数本身会对查看的对象进行一次引用

4
```
#### 三、垃圾回收机制
垃圾回收机制并不是一旦产生引用计数为 0 的对象就马上回收。而是不定时的对整个程序中的所有对象进行检测，检测对象为 0 才回收。

检测时间：当当前程序所有的对象引用计数变化的次数达到它的阈值才会对对象进行检测。
```
import gc 
# 获取垃圾回收临界值
print(gc.get_threshold())
# 修改垃圾回收临界值
print(gc.set_threshold(500, 10, 10))
```
#### 四、循环引用
**python的垃圾回收机制能够自动解决因为循环引用而导致的内存泄漏问题。**

python里面自动解决循环引用问题引用的其他的引用对象

检测的时候如果对象（object_i）的引用计数不是0，就备份引用计数值（count_i），去找到引用对象的对象（object_j），然后将（object_j）的引用计数（count_j）减1，如果（count_j）减1后的值是0，那么（count_i）的值就减1，如果减完后的（count_i）的值也是0，那么（object_j）也销毁。